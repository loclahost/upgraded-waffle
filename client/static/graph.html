<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8">
	<title>Logs as graph</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
</head>
<body>
    <div style="width:600px; height:600px">
        <canvas id="myChart" width="600" height="600"></canvas>
    </div>

    <script>
        var ctx = document.getElementById("myChart").getContext("2d");
        let datasets = [];
        $.getJSON("/log/point", function(data) {
            let logDataRequests = [];
            $.each(data, function(key, value){
                let logPoint = {};
                logPoint.label = value.loggerId;
                logPoint.data = [];
                datasets.push(logPoint);
                logDataRequests.push($.getJSON("/log/data", {id:value.loggerId}, function(data) {
                    $.each(data, function(key, value) {
                        logPoint.data.push({x:reformat(value.time),y:value.data});
                    });
                }));
            });
            $.when.apply($, logDataRequests).then(function() {
                var myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        datasets: datasets
                    },
                    options: {
                        responsive:false,
                        scales: {
                            xAxes: [{
                                type: 'time',
                                time: {
                                    minUnit: 'day',
                                    displayFormats: {
                                        day: 'YYYY-MM-DD HH:mm'
                                    }
                                }
                            }],
                            yAxes: [{
                                ticks: {
                                    beginAtZero:true
                                }
                            }]
                        }
                    }
                });
            });
        });
    </script>
</body>
</html>